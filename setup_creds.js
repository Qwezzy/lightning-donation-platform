import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const tlsHex = '2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d4949435054434341654f674177494241674951626a6b37354946416a324f565264542f4b535076487a414b42676771686b6a4f50515144416a41784d5238770a485159445651514b45785a73626d5167595856306232646c626d56795958526c5a43426a5a584a304d51347744415944565151444577566862476c6a5a5441650a467730794e6a41794d5441774f5445314d544661467730794e7a41304d4463774f5445314d5446614d444578487a416442674e5642416f54466d78755a4342680a645852765a3256755a584a686447566b49474e6c636e5178446a414d42674e5642414d544257467361574e6c4d466b77457759484b6f5a497a6a3043415159490a4b6f5a497a6a3044415163445167414553725a3538645132342b726c307a4f555a5355443053546639677364334a3761663851315a6e696e70336530674e596e0a4f452b454e764950335a49767535594b4e582f575941516a6a303243662f6a332b4d50357a614f42334443423254414f42674e56485138424166384542414d430a41715177457759445652306c42417777436759494b775942425155484177457744775944565230544151482f42415577417745422f7a416442674e56485134450a46675155323134546431725a564e33734b5478554c625565374e4645614d45776759454741315564455152364d4869434257467361574e6c67676c7362324e680a62476876633353434257467361574e6c6767357762327868636931754d53316862476c6a5a5949556147397a6443356b62324e725a584975615735305a584a750a595779434248567561586943436e56756158687759574e725a58534342324a315a6d4e76626d36484248384141414748454141414141414141414141414141410a4141414141414748424b775341414d77436759494b6f5a497a6a30454177494453414177525149676248336b6775534c38457272676f4a597163495a314441440a367255363031737338655269625a554b3033454349514335637a3545323739542f31794d38487a2b642b7634633469582f6e31474650654b2b326f70714776780a4f413d3d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a';
const macaroonHex = '0201036c6e6402f801030a10c673c1ca1081a756758db021201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a210a086d616361726f6f6e120867656e6572617465120472656164120577726974651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e657261746512047265616400000620a50b837ba31ddc24a869483c6e5d77159193d1c34bdca347d729db860f68b021';

// Clean newline chars from hex if any
const cleanTlsHex = tlsHex.replace(/[\r\n\s]/g, '');
const cleanMacaroonHex = macaroonHex.replace(/[\r\n\s]/g, '');

const tlsBuffer = Buffer.from(cleanTlsHex, 'hex');
const macaroonBuffer = Buffer.from(cleanMacaroonHex, 'hex');

// Write to backend/config/ as requested
const targetDir = path.join(__dirname, 'backend', 'config');

// Ensure directory exists
if (!fs.existsSync(targetDir)) {
    fs.mkdirSync(targetDir, { recursive: true });
}

fs.writeFileSync(path.join(targetDir, 'tls.cert'), tlsBuffer);
fs.writeFileSync(path.join(targetDir, 'admin.macaroon'), macaroonBuffer);

console.log(`Successfully wrote tls.cert and admin.macaroon to ${targetDir}`);
